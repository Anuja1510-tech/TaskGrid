<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TaskGrid — Dashboard</title>
<style>
  :root{
    --bg:#0c1022;
    --bg2:#0a0e1d;
    --card:rgba(255,255,255,.06);
    --card-deep:rgba(255,255,255,.08);
    --muted:#a6b0d1;
    --text:#e9ecff;
    --accent1:#06d7ff;
    --accent2:#7b2cff;
    --ok:#2ad39a;
    --warn:#ffb020;
    --bad:#ff5d6c;
    --ring: 0 0 0 1px rgba(255,255,255,.06) inset, 0 10px 30px rgba(0,0,0,.45);
  }

  /* Page */
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    color:var(--text);
    font:15px/1.45 "Segoe UI",Inter,system-ui,-apple-system,Arial,sans-serif;
    background:
      radial-gradient(1200px 600px at 70% -10%, #1a2042 0%, transparent 60%),
      radial-gradient(900px 500px at -10% 20%, #12183a 0%, transparent 55%),
      linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
    overflow:hidden;
  }

  /* Subtle starfield dots */
  .dots{position:fixed; inset:0; pointer-events:none; opacity:.35}
  .dots::before,.dots::after{
    content:""; position:absolute; inset:-20%;
    background-image:
      radial-gradient(#8ad 1px, transparent 1px),
      radial-gradient(#6cf 1px, transparent 1px),
      radial-gradient(#9bf 1px, transparent 1px);
    background-size: 120px 120px, 180px 180px, 240px 240px;
    background-position: 0 0, 40px 60px, 100px 20px;
    filter: blur(.2px);
    animation: drift 60s linear infinite;
  }
  .dots::after{animation-duration:85s; opacity:.8}
  @keyframes drift{to{transform:translateY(80px)}}

  /* App shell */
  .app{display:grid; grid-template-columns: 260px 1fr 330px; grid-template-rows: 72px 1fr; height:100%}

  .topbar{
    grid-column:1 / -1;
    display:flex; align-items:center; gap:16px;
    padding:12px 18px;
    border-bottom:1px solid rgba(255,255,255,.06);
    background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
    backdrop-filter: blur(10px);
  }
  .brand{display:flex; align-items:center; gap:10px; margin-right:auto}
  .logo{
    width:36px; height:36px; border-radius:10px;
    background:linear-gradient(135deg, var(--accent1), var(--accent2));
    display:grid; place-items:center; font-weight:800
  }
  .brand h1{font-size:16px; margin:0; letter-spacing:.4px; opacity:.95}
  .role-badge{
    padding:6px 10px; border-radius:999px;
    background:linear-gradient(90deg, rgba(6,215,255,.15), rgba(123,44,255,.15));
    border:1px solid rgba(123,44,255,.35);
    font-size:12px; letter-spacing:.3px
  }
  .top-actions{display:flex; align-items:center; gap:10px}
  .btn, .btn-ghost{
    padding:10px 14px; border-radius:12px; border:0; cursor:pointer; font-weight:600; color:var(--text)
  }
  .btn{
    background:linear-gradient(90deg, var(--accent1), var(--accent2));
    box-shadow:0 8px 24px rgba(123,44,255,.3)
  }
  .btn-ghost{background:rgba(255,255,255,.06)}
  .select{
    appearance:none; background:rgba(255,255,255,.06); border:0; color:var(--text);
    padding:10px 36px 10px 12px; border-radius:12px; font-weight:600; position:relative
  }

  /* Sidebar */
  .side{
    padding:16px; border-right:1px solid rgba(255,255,255,.06); background:rgba(0,0,0,.15); backdrop-filter: blur(8px)
  }
  .menu{display:flex; flex-direction:column; gap:8px}
  .menu h3{margin:10px 8px 6px; color:#b8c1ea; font-size:12px; letter-spacing:.15em; text-transform:uppercase}
  .item{
    padding:12px 12px; border-radius:12px; background:transparent; color:var(--text); text-decoration:none; display:flex; align-items:center; gap:10px
  }
  .item.active, .item:hover{
    background:linear-gradient(90deg, rgba(6,215,255,.12), rgba(123,44,255,.12));
    box-shadow:0 1px 0 0 rgba(255,255,255,.04) inset
  }

  /* Main */
  .main{padding:18px 18px 22px; overflow:auto}
  .grid{
    display:grid; gap:16px;
    grid-template-columns: repeat(12,1fr);
  }
  .card{
    background:var(--card); border-radius:18px; box-shadow:var(--ring); padding:16px
  }
  .kpi{grid-column: span 3; min-width:220px}
  .kpi h4{margin:2px 0 6px; color:#b8c1ea; font-size:12px; letter-spacing:.12em; text-transform:uppercase}
  .kpi .num{font-size:26px; font-weight:800}
  .kpi small{color:var(--muted)}

  .section-title{display:flex; align-items:center; justify-content:space-between; margin:6px 2px 10px}
  .section-title h2{margin:0; font-size:18px}
  .chips{display:flex; gap:8px}
  .chip{
    font-size:12px; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.08)
  }

  /* Project/task cards */
  .proj{grid-column: span 6; display:flex; flex-direction:column; gap:10px}
  .proj h3{margin:0 0 2px; font-size:16px}
  .meta{display:flex; gap:10px; color:var(--muted); font-size:12px}
  .progress{
    height:8px; border-radius:999px; background:rgba(255,255,255,.09); overflow:hidden; position:relative
  }
  .progress > i{
    display:block; height:100%; width:0%;
    background:linear-gradient(90deg, var(--accent1), var(--accent2));
    transition:width .45s ease
  }
  .assignees{display:flex; gap:6px; margin-top:6px}
  .pill{
    padding:6px 9px; border-radius:999px; font-size:12px; background:rgba(255,255,255,.08)
  }

  /* Right rail */
  .rail{
    padding:16px; border-left:1px solid rgba(255,255,255,.06); background:rgba(0,0,0,.15); backdrop-filter: blur(8px);
    overflow:auto
  }
  .notif{display:flex; gap:10px; padding:10px; border-radius:14px; background:var(--card); margin-bottom:10px}
  .dot{width:10px; height:10px; border-radius:50%}
  .dot.ok{background:var(--ok)} .dot.warn{background:var(--warn)} .dot.bad{background:var(--bad)}

  /* Responsive */
  @media (max-width:1200px){
    .app{grid-template-columns: 220px 1fr 0; grid-template-rows: 72px 1fr}
    .rail{display:none}
    .proj{grid-column: span 12}
    .kpi{grid-column: span 6}
  }
  @media (max-width:820px){
    .side{display:none}
    .app{grid-template-columns:1fr}
    .kpi{grid-column: span 12}
  }
</style>
</head>
<body>
<div class="dots"></div>

<div class="app">

  <!-- Topbar -->
  <header class="topbar">
    <div class="brand">
      <div class="logo">TG</div>
      <h1>TaskGrid</h1>
      <span id="roleBadge" class="role-badge">Role: …</span>
    </div>
    <div class="top-actions">
      <!-- role switcher for demo -->
      <select id="roleSwitch" class="select" title="Switch role">
        <option value="Member">Member</option>
        <option value="Manager">Manager</option>
        <option value="Admin">Admin</option>
      </select>
      <button class="btn-ghost" onclick="alert('Search coming soon')">Search</button>
      <button class="btn" onclick="logout()">Logout</button>
    </div>
  </header>

  <!-- Sidebar -->
  <aside class="side">
    <nav id="menu" class="menu"></nav>
  </aside>

  <!-- Main content -->
  <main class="main">
    <div class="grid" id="content">
      <!-- KPI Row -->
      
      <div class="card kpi">
        <h4>Open Tasks</h4>
        <div class="num" id="kpiTasks">0</div>
        <small>pending items</small>
      </div>
      <div class="card kpi">
        <h4>On Track</h4>
        <div class="num" id="kpiOnTrack">0%</div>
        <small>project health</small>
      </div>
      <div class="card kpi">
        <h4>Notifications</h4>
        <div class="num" id="kpiNotifs">0</div>
        <small>last 7 days</small>
      </div>

      <!-- Section header -->
      <div class="section-title" style="grid-column:1 / -1;">
        <h2 id="sectionTitle">Your Projects</h2>
        <div class="chips">
          <span class="chip">Kanban</span>
          <span class="chip">Timelines</span>
          <span class="chip">Reports</span>
        </div>
      </div>

      <!-- Project/Task cards container (filled by JS) -->
      <div id="cardsMount" class="grid" style="grid-column:1 / -1;"></div>
    </div>
  </main>

  <!-- Right rail -->
  <aside class="rail">
    <div class="card" style="margin-bottom:12px;">
      <div class="section-title">
        <h2>Recent Updates</h2>
        <span class="chip">Live</span>
      </div>
      <div id="updates"></div>
    </div>

    <div class="card">
      <div class="section-title">
        <h2>Notifications</h2>
        <span class="chip" id="notifFilter">All</span>
      </div>
      <div id="notifs"></div>
    </div>
  </aside>
</div>

<script>
/* ------- Demo data ------- */
const sample = {
  projects: [
    { id:1, name:"Website Revamp", progress:72, owner:"Ava", health:"ok", openTasks:12 },
    { id:2, name:"Mobile App v2", progress:45, owner:"Liam", health:"warn", openTasks:23 },
    { id:3, name:"Data Lake", progress:30, owner:"Noah", health:"ok", openTasks:9 },
    { id:4, name:"Onboarding Flow", progress:90, owner:"Mia", health:"ok", openTasks:4 }
  ],
  tasksMine: [
    { id:201, title:"Design empty states", project:"Website Revamp", progress:40, due:"Fri" },
    { id:202, title:"Fix login edge case", project:"Mobile App v2", progress:70, due:"Tomorrow" },
    { id:203, title:"Write release notes", project:"Onboarding Flow", progress:10, due:"Mon" }
  ],
  updates: [
    { t:"Oliver moved 'Add OAuth' to In Review", kind:"ok" },
    { t:"2 blockers flagged in Data Lake", kind:"bad" },
    { t:"Sprint report generated", kind:"warn" },
    { t:"Ava mentioned you in Website Revamp", kind:"ok" }
  ],
  notifs: [
    { t:"You were assigned 3 tasks", kind:"ok" },
    { t:"Deadline approaching: Release notes", kind:"warn" },
    { t:"Build failed in CI pipeline", kind:"bad" }
  ]
};

/* ------- Role & shell wiring ------- */
const roleSwitch = document.getElementById('roleSwitch');
const roleBadge  = document.getElementById('roleBadge');
const menuMount  = document.getElementById('menu');
const cardsMount = document.getElementById('cardsMount');
const sectionTitle = document.getElementById('sectionTitle');

function detectRole(){
  // read from setup wizard if present
  const saved = JSON.parse(localStorage.getItem('taskgridSetup')||'{}');
  const r = saved.role || 'Member';
  roleSwitch.value = r;
  return r;
}

let role = detectRole();
updateRoleUI();

roleSwitch.addEventListener('change', ()=>{
  role = roleSwitch.value;
  roleBadge.textContent = `Role: ${role}`;
  renderMenu();
  renderMain();
});

function updateRoleUI(){
  roleBadge.textContent = `Role: ${role}`;
  renderMenu();
  renderRightRail();
  renderMain();
  fillKPIs();
}

function renderMenu(){
  const groups = {
    Admin: [
      ["Projects","/projects"],
      ["Tasks","/tasks"],
      ["Users","/users"],
      ["Report Analysis","/report-analysis"],
      ["Profile","/profile"]
    ],
    Manager: [
      ["Projects","/projects"],
      ["Tasks","/tasks"],
      ["Notifications","/notifications"],
      ["Report Analysis","/report-analysis"],
      ["Profile","/profile"]
    ],
    Member: [
      ["Tasks","/tasks"],
      ["Projects","/projects"],
      ["Notifications","/notifications"],
      ["Report Analysis","/report-analysis"],
      ["Profile","/profile"]
    ]
  };
  
  const list = groups[role] || groups.Member;
  menuMount.innerHTML = `<h3>Menu</h3>` + list.map(([label]) =>
    `<div class="item${label==='Projects'?' active':''}" onclick="navigateToSection('${label}')">${label}</div>`
  ).join('');
}


/* ------- Main area ------- */
function renderMain(){
  cardsMount.innerHTML = '';
  if(role==='Admin'){
    sectionTitle.textContent = "Workspace Projects";
    sample.projects.forEach(p => cardsMount.appendChild(ProjectCard(p)));
    cardsMount.appendChild(AdminPanel());
  }else if(role==='Manager'){
    sectionTitle.textContent = "Projects & Team Tasks";
    sample.projects.forEach(p => cardsMount.appendChild(ProjectCard(p)));
    sample.tasksMine.forEach(t => cardsMount.appendChild(TaskCard(t)));
  }else{
    sectionTitle.textContent = "Your Tasks";
    sample.tasksMine.forEach(t => cardsMount.appendChild(TaskCard(t)));
  }
}

function ProjectCard(p){
  const el = document.createElement('div');
  el.className = 'card proj';
  el.innerHTML = `
    <h3>${p.name}</h3>
    <div class="meta"><span>Owner: ${p.owner}</span> • <span>${p.openTasks} open tasks</span></div>
    <div class="progress"><i style="width:${p.progress}%"></i></div>
    <div class="assignees">
      <span class="pill">${p.health==='ok'?'On Track':p.health==='warn'?'At Risk':'Blocked'}</span>
      <span class="pill">Progress ${p.progress}%</span>
    </div>
  `;
  el.style.gridColumn = 'span 6';
  return el;
}

function TaskCard(t){
  const el = document.createElement('div');
  el.className = 'card proj';
  el.innerHTML = `
    <h3>${t.title}</h3>
    <div class="meta"><span>${t.project}</span> • <span>Due ${t.due}</span></div>
    <div class="progress"><i style="width:${t.progress}%"></i></div>
    <div class="assignees">
      <span class="pill">My Task</span>
      <span class="pill">Progress ${t.progress}%</span>
    </div>
  `;
  el.style.gridColumn = 'span 6';
  return el;
}

function AdminPanel(){
  const el = document.createElement('div');
  el.className = 'card';
  el.style.gridColumn = '1 / -1';
  el.innerHTML = `
    <div class="section-title" style="margin-bottom:8px;">
      <h2>Admin Controls</h2>
      <span class="chip">Danger Zone</span>
    </div>
    <div style="display:flex; gap:12px; flex-wrap:wrap;">
      <button class="btn-ghost" onclick="alert('Invite link copied!')">Invite User</button>
      <button class="btn-ghost" onclick="alert('Roles updated!')">Manage Roles</button>
      <button class="btn-ghost" onclick="alert('Exported CSV')">Export Data</button>
      <button class="btn-ghost" onclick="alert('Settings opened')">Workspace Settings</button>
    </div>
  `;
  return el;
}

/* ------- Right rail ------- */
function renderRightRail(){
  document.getElementById('updates').innerHTML =
    sample.updates.map(u => `
      <div class="notif"><span class="dot ${u.kind}"></span><div>${u.t}</div></div>
    `).join('');

  document.getElementById('notifs').innerHTML =
    sample.notifs.map(n => `
      <div class="notif"><span class="dot ${n.kind}"></span><div>${n.t}</div></div>
    `).join('');
}

/* ------- KPIs ------- */
function fillKPIs(){
  const proj = sample.projects.length;
  const openTasks = sample.projects.reduce((a,b)=>a+b.openTasks,0);
  const onTrack = Math.round(
    (sample.projects.filter(p=>p.health==='ok').length / proj) * 100
  );
  const notifs = sample.notifs.length + sample.updates.length;

  document.getElementById('kpiProjects').textContent = proj;
  document.getElementById('kpiTasks').textContent = openTasks;
  document.getElementById('kpiOnTrack').textContent = onTrack + '%';
  document.getElementById('kpiNotifs').textContent = notifs;
}

/* ------- Logout ------- */
function logout(){
  // keep setup data so role persists across sessions; clear if you prefer:
  // localStorage.removeItem('taskgridSetup');
  window.location.href = "#logged-out";
  alert('Logged out (demo). Hook this to your auth flow.');
}
</script>
</body>
</html>
